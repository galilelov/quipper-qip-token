<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>CFA Game Blitz - 17000+</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; background: #1a1a2e; color: white; margin: 0; overflow: hidden; }
        #game-container { width: 350px; margin-top: 30px; text-align: center; background: #16213e; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #status-bar { display: flex; justify-content: space-between; width: 100%; margin-bottom: 20px; font-size: 18px; color: #00d2ff; }
        #question-box { font-size: 36px; font-weight: bold; margin-bottom: 10px; height: 60px; display: flex; align-items: center; justify-content: center; }
        #grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .cell { 
            width: 100px; height: 100px; background: #0f3460; border: 2px solid #1a1a2e;
            color: white; font-size: 32px; cursor: pointer; border-radius: 12px;
            transition: all 0.1s; display: flex; align-items: center; justify-content: center; outline: none;
        }
        .cell:hover { border-color: #e94560; background: #1a1a2e; }
        .cell:active { transform: scale(0.9); }
        #timer-container { width: 100%; height: 8px; background: #333; margin-bottom: 20px; border-radius: 4px; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: #e94560; }
        .correct { background: #2ecc71 !important; }
        .wrong { background: #e74c3c !important; }
        #msg { height: 30px; margin-top: 10px; color: #aaa; }
        #start-btn { margin-top: 20px; padding: 15px 50px; font-size: 20px; background: #e94560; color: white; border: none; border-radius: 10px; cursor: pointer; display: none; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="status-bar">
        <span>üí∞ <b id="tokens">0</b></span>
        <span>‚ù§Ô∏è –ü–æ–ø—ã—Ç–∫–∏: <b id="attempts">3</b></span>
    </div>

    <div id="question-box">–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã...</div>
    
    <div id="timer-container">
        <div id="timer-bar"></div>
    </div>

    <div id="grid">
        <button class="cell" onclick="makeMove(1)">1</button>
        <button class="cell" onclick="makeMove(2)">2</button>
        <button class="cell" onclick="makeMove(3)">3</button>
        <button class="cell" onclick="makeMove(4)">4</button>
        <button class="cell" onclick="makeMove(5)">5</button>
        <button class="cell" onclick="makeMove(6)">6</button>
        <button class="cell" onclick="makeMove(7)">7</button>
        <button class="cell" onclick="makeMove(8)">8</button>
        <button class="cell" onclick="makeMove(9)">9</button>
    </div>

    <div id="msg"></div>
    <button id="start-btn" onclick="nextQuestion()">–ò–ì–†–ê–¢–¨</button>
</div>

<script>
    let tokens = 0, attempts = 3, currentAnswer = 0, timer, canClick = false;
    let allQuestions = [];

    // –®–ê–ì 1: –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑—É –∏–∑ JSON
    async function init() {
        try {
            const res = await fetch('questions.json');
            allQuestions = await res.json();
            document.getElementById('question-box').innerText = "–ì–æ—Ç–æ–≤!";
            document.getElementById('start-btn').style.display = 'inline-block';
        } catch (e) {
            document.getElementById('question-box').innerText = "–û—à–∏–±–∫–∞ JSON!";
        }
    }

    function nextQuestion() {
        const q = allQuestions[Math.floor(Math.random() * allQuestions.length)];
        currentAnswer = q.a;
        attempts = 3;
        canClick = false;
        
        document.getElementById('question-box').innerText = q.q;
        document.getElementById('attempts').innerText = attempts;
        document.getElementById('start-btn').style.display = 'none';
        document.getElementById('msg').innerText = "";
        
        resetStyles();
        startTimer(q.t);
        setTimeout(() => { canClick = true; }, 500); // –ê–Ω—Ç–∏-–±–æ—Ç
    }

    function startTimer(duration) {
        clearInterval(timer);
        const bar = document.getElementById('timer-bar');
        bar.style.transition = 'none';
        bar.style.width = '100%';
        
        setTimeout(() => {
            bar.style.transition = `width ${duration}ms linear`;
            bar.style.width = '0%';
        }, 50);

        timer = setTimeout(() => {
            gameOver("–í—Ä–µ–º—è –≤—ã—à–ª–æ!");
        }, duration);
    }

    function makeMove(num) {
        if (!canClick) return;
        const cells = document.getElementsByClassName('cell');
        
        if (num === currentAnswer) {
            clearInterval(timer);
            let reward = [0, 1, 5, 10][attempts]; // 10 –∑–∞ 1-—é –ø–æ–ø—ã—Ç–∫—É, 5 –∑–∞ 2-—é, 1 –∑–∞ 3-—é
            tokens += reward;
            document.getElementById('tokens').innerText = tokens;
            cells[num-1].classList.add('correct');
            canClick = false;
            document.getElementById('msg').innerText = `+${reward} —Ç–æ–∫–µ–Ω–æ–≤!`;
            setTimeout(nextQuestion, 1000);
        } else {
            attempts--;
            document.getElementById('attempts').innerText = attempts;
            cells[num-1].classList.add('wrong');
            if (attempts <= 0) gameOver("–ü–æ–ø—ã—Ç–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!");
        }
    }

    function gameOver(txt) {
        clearInterval(timer);
        canClick = false;
        document.getElementById('msg').innerText = txt + " –û—Ç–≤–µ—Ç: " + currentAnswer;
        document.getElementById('start-btn').style.display = 'inline-block';
        document.getElementById('start-btn').innerText = "–ï–©–ï –†–ê–ó";
    }

    function resetStyles() {
        const cells = document.getElementsByClassName('cell');
        for (let c of cells) c.classList.remove('correct', 'wrong');
    }

    init();
</script>
</body>
</html>

