<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <!-- –≠—Ç–æ —Å–∞–º–∞—è –≤–∞–∂–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Blitz CFA</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            margin: 0; padding: 10px;
            background: #1a1a2e; color: white; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤—Å—é –≤—ã—Å–æ—Ç—É —ç–∫—Ä–∞–Ω–∞ */
        }

        #game-container { 
            width: 100%; 
            max-width: 500px; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–æ–≤, –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö –±—É–¥–µ—Ç 100% */
            background: #16213e; 
            padding: 20px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
        }

        #status-bar { 
            display: flex; justify-content: space-between; 
            margin-bottom: 20px; font-size: 22px; font-weight: bold; color: #00d2ff; 
        }

        #question-box { 
            font-size: 10vw; /* –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —à–∏—Ä–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞ */
            max-font-size: 48px;
            font-weight: bold; margin-bottom: 15px; 
            height: 80px; display: flex; align-items: center; justify-content: center; 
            background: rgba(0,0,0,0.2); border-radius: 10px;
        }

        #timer-container { width: 100%; height: 12px; background: #333; margin-bottom: 25px; border-radius: 6px; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: #e94560; }

        #grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 15px; /* –£–≤–µ–ª–∏—á–∏–ª–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
        }

        .cell { 
            aspect-ratio: 1 / 1; /* –ö–Ω–æ–ø–∫–∏ –≤—Å–µ–≥–¥–∞ –±—É–¥—É—Ç –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º–∏ */
            background: #0f3460; border: 2px solid #1a1a2e;
            color: white; font-size: 40px; font-weight: bold;
            cursor: pointer; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.05s, background 0.1s;
            outline: none;
        }

        .cell:active { transform: scale(0.9); background: #e94560; }
        .correct { background: #2ecc71 !important; border-color: #fff !important; }
        .wrong { background: #e74c3c !important; }

        #msg { height: 40px; margin-top: 15px; font-size: 20px; color: #00d2ff; }

        #start-btn { 
            margin-top: 20px; width: 100%; padding: 20px; 
            font-size: 24px; font-weight: bold;
            background: #e94560; color: white; border: none; border-radius: 15px; 
            cursor: pointer; display: none;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="status-bar">
        <span>üí∞ <b id="tokens">0</b></span>
        <span>‚ù§Ô∏è <b id="attempts">3</b></span>
    </div>

    <div id="question-box">–ó–ê–ì–†–£–ó–ö–ê...</div>
    
    <div id="timer-container">
        <div id="timer-bar"></div>
    </div>

    <div id="grid">
        <button class="cell" onclick="makeMove(1)">1</button>
        <button class="cell" onclick="makeMove(2)">2</button>
        <button class="cell" onclick="makeMove(3)">3</button>
        <button class="cell" onclick="makeMove(4)">4</button>
        <button class="cell" onclick="makeMove(5)">5</button>
        <button class="cell" onclick="makeMove(6)">6</button>
        <button class="cell" onclick="makeMove(7)">7</button>
        <button class="cell" onclick="makeMove(8)">8</button>
        <button class="cell" onclick="makeMove(9)">9</button>
    </div>

    <div id="msg"></div>
    <button id="start-btn" onclick="nextQuestion()">–ò–ì–†–ê–¢–¨</button>
</div>

<script>
    let tokens = 0, attempts = 3, currentAnswer = 0, timer, canClick = false;
    let allQuestions = [];

    async function init() {
        try {
            // –î–æ–±–∞–≤–ª—è–µ–º timestamp —á—Ç–æ–±—ã JSON –Ω–µ –∫—ç—à–∏—Ä–æ–≤–∞–ª—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö
            const res = await fetch('questions.json?v=' + Date.now());
            allQuestions = await res.json();
            document.getElementById('question-box').innerText = "–ì–û–¢–û–í!";
            document.getElementById('start-btn').style.display = 'block';
        } catch (e) {
            document.getElementById('question-box').innerText = "–û–®–ò–ë–ö–ê JSON";
        }
    }

    function nextQuestion() {
        if(allQuestions.length === 0) return;
        const q = allQuestions[Math.floor(Math.random() * allQuestions.length)];
        currentAnswer = q.a;
        attempts = 3;
        canClick = false;
        
        document.getElementById('question-box').innerText = q.q;
        document.getElementById('attempts').innerText = attempts;
        document.getElementById('start-btn').style.display = 'none';
        document.getElementById('msg').innerText = "";
        
        resetStyles();
        startTimer(q.t);
        setTimeout(() => { canClick = true; }, 500);
    }

    function startTimer(duration) {
        clearInterval(timer);
        const bar = document.getElementById('timer-bar');
        bar.style.transition = 'none';
        bar.style.width = '100%';
        
        setTimeout(() => {
            bar.style.transition = `width ${duration}ms linear`;
            bar.style.width = '0%';
        }, 50);

        timer = setTimeout(() => {
            gameOver("–í–†–ï–ú–Ø –í–´–®–õ–û!");
        }, duration);
    }

    function makeMove(num) {
        if (!canClick) return;
        const cells = document.getElementsByClassName('cell');
        
        if (num === currentAnswer) {
            clearInterval(timer);
            let reward = [0, 1, 5, 10][attempts];
            tokens += reward;
            document.getElementById('tokens').innerText = tokens;
            cells[num-1].classList.add('correct');
            canClick = false;
            document.getElementById('msg').innerText = `+${reward} –¢–û–ö–ï–ù–û–í`;
setTimeout(nextQuestion, 800);
        } else {
            attempts--;
            document.getElementById('attempts').innerText = attempts;
            cells[num-1].classList.add('wrong');
            if (attempts <= 0) gameOver("–ö–û–ù–ï–¶ –ò–ì–†–´!");
        }
    }

    function gameOver(txt) {
        clearInterval(timer);
        canClick = false;
        document.getElementById('msg').innerText = txt + " –û–¢–í–ï–¢: " + currentAnswer;
        document.getElementById('start-btn').style.display = 'block';
        document.getElementById('start-btn').innerText = "–ï–©–ï –†–ê–ó";
    }

    function resetStyles() {
        const cells = document.getElementsByClassName('cell');
        for (let c of cells) c.classList.remove('correct', 'wrong');
    }

    init();
</script>
</body>
</html>


