<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Blitz</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: manipulation; }
        
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            margin: 0; padding: 5px;
            background: #1a1a2e; color: white; 
            display: flex; flex-direction: column; align-items: center; 
            height: 100dvh; overflow: hidden; /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É —ç–∫—Ä–∞–Ω–∞ */
        }

        #game-container { 
            width: 100%; max-width: 400px;
            height: 100%;
            display: flex; flex-direction: column;
            justify-content: space-between; /* –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –≤—ã—Å–æ—Ç–µ */
            padding: 10px 15px;
        }

        #status-bar { 
            display: flex; justify-content: space-between; 
            font-size: 20px; font-weight: bold; color: #00d2ff;
            height: 30px;
        }

        #question-box { 
            font-size: 45px; font-weight: bold; 
            height: 80px; display: flex; align-items: center; justify-content: center; 
            background: rgba(255,255,255,0.05); border-radius: 15px;
            margin: 5px 0;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–π–º–µ—Ä–∞ –ò–õ–ò –æ—Ç–≤–µ—Ç–∞ */
        #timer-area { 
            width: 100%; height: 40px; 
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 10px;
        }

        #timer-container { 
            width: 100%; height: 10px; background: #333; 
            border-radius: 5px; overflow: hidden; 
        }

        #timer-bar { width: 100%; height: 100%; background: #e94560; }

        #answer-display { 
            font-size: 22px; font-weight: bold; color: #ff4757; 
            display: none; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }

        #grid { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;
            flex-grow: 0;
        }

        .cell { 
            aspect-ratio: 1 / 1; background: #16213e; border: 2px solid #0f3460;
            color: white; font-size: 32px; font-weight: bold;
            cursor: pointer; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
        }
        .cell:active { background: #e94560; transform: scale(0.95); }
        .correct { background: #2ecc71 !important; border-color: white !important; }
        .wrong { background: #e74c3c !important; }

        #start-btn { 
            width: 100%; padding: 15px; margin-top: 10px;
            font-size: 22px; font-weight: bold;
            background: #e94560; color: white; border: none; border-radius: 12px; 
            cursor: pointer; display: none;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="status-bar">
        <span>üí∞ <b id="tokens">0</b></span>
        <span>‚ù§Ô∏è <b id="attempts">3</b></span>
    </div>

    <div id="question-box">–ó–ê–ì–†–£–ó–ö–ê</div>
    
    <div id="timer-area">
        <div id="timer-container"><div id="timer-bar"></div></div>
        <div id="answer-display">–û–¢–í–ï–¢: <span id="correct-val"></span></div>
    </div>

    <div id="grid">
        <button class="cell" onclick="makeMove(1)">1</button>
        <button class="cell" onclick="makeMove(2)">2</button>
        <button class="cell" onclick="makeMove(3)">3</button>
        <button class="cell" onclick="makeMove(4)">4</button>
        <button class="cell" onclick="makeMove(5)">5</button>
        <button class="cell" onclick="makeMove(6)">6</button>
        <button class="cell" onclick="makeMove(7)">7</button>
        <button class="cell" onclick="makeMove(8)">8</button>
        <button class="cell" onclick="makeMove(9)">9</button>
    </div>

    <button id="start-btn" onclick="nextQuestion()">–ò–ì–†–ê–¢–¨</button>
</div>

<script>
    let tokens = 0, attempts = 3, currentAnswer = 0, timer, canClick = false;
    let allQuestions = [];

    async function init() {
        try {
            const res = await fetch('questions.json?v=' + Date.now());
            allQuestions = await res.json();
            document.getElementById('question-box').innerText = "–ì–û–¢–û–í";
            document.getElementById('start-btn').style.display = 'block';
        } catch (e) {
            document.getElementById('question-box').innerText = "–û–®–ò–ë–ö–ê";
        }
    }

    function nextQuestion() {
        if(allQuestions.length === 0) return;
        const q = allQuestions[Math.floor(Math.random() * allQuestions.length)];
        currentAnswer = q.a;
        attempts = 3;
        canClick = false;
        
        document.getElementById('question-box').innerText = q.q;
        document.getElementById('attempts').innerText = attempts;
        document.getElementById('start-btn').style.display = 'none';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä, —Å–∫—Ä—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
        document.getElementById('timer-container').style.display = 'block';
        document.getElementById('answer-display').style.display = 'none';
        
        resetStyles();
        startTimer(q.t);
        setTimeout(() => { canClick = true; }, 500);
    }

    function startTimer(duration) {
        clearInterval(timer);
        const bar = document.getElementById('timer-bar');
        bar.style.transition = 'none';
        bar.style.width = '100%';
        
        setTimeout(() => {
            bar.style.transition = `width ${duration}ms linear`;
            bar.style.width = '0%';
        }, 50);

        timer = setTimeout(() => {
            showResult("–í–†–ï–ú–Ø –í–´–®–õ–û");
        }, duration);
    }

    function makeMove(num) {
        if (!canClick) return;
        const cells = document.getElementsByClassName('cell');
        
        if (num === currentAnswer) {
            clearInterval(timer);
            let reward = [0, 1, 5, 10][attempts];
            tokens += reward;
            document.getElementById('tokens').innerText = tokens;
            cells[num-1].classList.
